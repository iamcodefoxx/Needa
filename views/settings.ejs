<%- include("partials/header.ejs") %>

<style>
  body{
    background-color: #e9e9e9;
  }
</style>

  <div class="container">
    <div class="subcontainer">

      <% if (success != "" ) { %>
        <div class="alert-message-wrapper">
          <div class="alert-message success">
            <p>
              <%= success %>
            </p>
          </div>
        </div>
      <% } %>

      <% if (typeof allParsedErrors !="undefined" && allParsedErrors) { %>
        <% for(let i=0; i < allParsedErrors.errors.length; i++ ) { %>
          <div class="alert-message-wrapper">
            <div class="alert-message">
              <%= (allParsedErrors.errors[i].msg) %>
            </div>
          </div>
        <% } %>
      <% } %>
  
      <div class="settings-wrapper">


        <div class="settings-col-1">
          <div class="settings-col-1-child-1">
            <h2>User Settings</h2>
          </div>
          <div class="settings-col-1-child-2">
            <div class="settings-col-1-link">
              <a href="/settings" style="color:#009999;">
                <div class="flex">
                  <i class="fas fa-user-circle"></i>
                  <p>PROFILE</p>
                </div>
              </a>
            </div>
            <div class="settings-col-1-link">
              <a href="/settings/account">
                <div class="flex">
                  <i class="fas fa-cog"></i>
                  <p>ACCOUNT</p>
                </div>
              </a>
            </div>
          </div>
        </div>


        <div class="forms-container">

          <form action="/auth/settings" method="POST" class="settings-col-2" enctype="multipart/form-data">
          
            <div class="settings-col-2-wrapper">
              <div class="settings-col-2-child">
          
          
                <!-- BASIC INFO  -->
          
          
                <h3>Basic Info</h3>
          
                <!-- PROFILE PHOTO UPLOAD -->
          
                <div class="user-input">
          
                  <div class="flex-4">
                    <label>Profile Photo</label>
                    <i class="far fa-trash-alt" id="trashProfilePhoto"></i>
                    <input type="hidden" name="deleteProfilePhoto" id="delProPhoto">
                  </div>
          
                  <div class="profile-photo-container flex-2">
                    <i class="fas fa-cloud-upload" id="uploadCloudPro"></i>
                    <input type="file" id="profilePhoto" name="profile_photo" accept="image/jpeg, image/png, image/jpg">
                  </div>
          
                </div>
          
                <!-- COVER PHOTO UPLOAD -->
          
                <div class="user-input">
          
                  <div class="flex-4">
                    <label>Cover Photo</label>
                    <i class="far fa-trash-alt" id="trashCoverPhoto"></i>
                    <input type="hidden" name="deleteCoverPhoto" id="delCovPhoto">
                  </div>
          
                  <div class="cover-photo-container flex-2">
                    <i class="fas fa-cloud-upload" id="uploadCloudCov"></i>
                    <input type="file" id="coverPhoto" name="cover_photo" accept="image/jpeg, image/png, image/jpg">
                  </div>
          
                </div>
          
                <!--  -->
          
                <div class="user-input">
                  <label for="first_name">First name</label>
                  <input type="text" name="first_name" id="first_name" placeholder="Enter your first name"
                    value="<%= user.first_name %>" maxlength="30">
                </div>
                <div class="user-input">
                  <label for="last_name">Last name</label>
                  <input type="text" name="last_name" placeholder="Enter your last name" value="<%= user.last_name %>"
                    maxlength="30">
                </div>
                <div class="user-input">
                  <label for="city">City</label>
                  <input type="text" name="city" placeholder="Enter your city" value="<%= user.city %>" maxlength="60">
                </div>
                <div class="user-input">
                  <label for="state">State</label>
                  <select name="state" id="state">
                    <option value="<%= user.state %>">
                      <%= user.state %>
                    </option>
                  </select>
                </div>
                <div class="user-input">
                  <% if(user.gender==="M" ) { %>
                    <label for="gender">Gender</label>
                    <div class="flex" style="width: 60px;">
                      <input type="radio" name="gender" value="M" checked>
                      <label for="M">Male</label>
                    </div>
                    <div class="flex" style="width: 78px;">
                      <input type="radio" name="gender" value="F">
                      <label for="F">Female</label>
                    </div>
                  <% } else if (user.gender==="F" ) { %>
                    <label for="gender">Gender</label>
                    <div class="flex" style="width: 60px;">
                      <input type="radio" name="gender" value="M">
                      <label for="M">Male</label>
                    </div>
                    <div class="flex" style="width: 78px;">
                      <input type="radio" name="gender" value="F" checked>
                      <label for="F">Female</label>
                    </div>
                  <% } else { %>
                    <label for="gender">Gender</label>
                    <div class="flex" style="width: 60px;">
                      <input type="radio" name="gender" value="M">
                      <label for="M">Male</label>
                    </div>
                    <div class="flex" style="width: 78px;">
                      <input type="radio" name="gender" value="F">
                      <label for="F">Female</label>
                    </div>
                  <% } %>
                </div>
          
          
                <!-- ABOUT YOU  -->
          
                <br>
          
                <h3>About You</h3>
                <div class="user-input">
                  <label for="profession">Profession</label>
                  <input type="text" name="profession" placeholder="e.g. Electrician" value="<%= user.profession %>"
                    maxlength="50">
                </div>
                <div class="user-input">
                  <label for="specialty">Services</label>
                  <textarea name="specialty" id="" placeholder="I specialize in..."
                    maxlength="255"><%= user.specialty %></textarea>
                </div>
                <div class="user-input">
                  <label for="about">About</label>
                  <textarea name="about" placeholder="I have 10 year experience..." maxlength="1000"><%= user.about %></textarea>
                </div>
                <div class="user-input">
                  <label for="skills">Skills</label>
                  <input type="text" name="skills" placeholder="Carpentry, Electrical, Plumbing..." value="<%= user.skills %>"
                    maxlength="1000">
                </div>
              </div>
          
          
              <!-- SOCIAL  -->
          
          
              <div class="settings-col-2-child">
                <h3>Social</h3>
                <div class="user-input">
                  <label for="website">Website</label>
                  <input type="text" name="website" placeholder="https://johndoe.com" value="<%= user.website %>" maxlength="255">
                </div>
                <div class="user-input">
                  <label for="twitter">Twitter</label>
                  <input type="text" name="twitter" placeholder="https://twitter.com/johndoe" value="<%= user.twitter %>"
                    maxlength="255">
                </div>
                <div class="user-input">
                  <label for="instagram">Instagram</label>
                  <input type="text" name="instagram" placeholder="https://instagram.com/johndoe" value="<%= user.instagram %>"
                    maxlength="255">
                </div>
                <div class="user-input">
                  <label for="facebook">Facebook</label>
                  <input type="text" name="facebook" placeholder="https://facebook.com/johndoe" value="<%= user.facebook %>"
                    maxlength="255">
                </div>
                <div class="user-input">
                  <label for="linkedin">LinkedIn</label>
                  <input type="text" name="linkedin" placeholder="https://www.linkedin.com/in/johndoe"
                    value="<%= user.linkedin %>" maxlength="255">
                </div>
          
          
                <!-- PROFILE IDENTITY  -->
          
                <br>
          
                <h3>Profile identity</h3>
                <div class="user-input">
                  <input type="phone" name="phone" placeholder="Enter your phone number" value="<%= user.phone %>" maxlength="11">
                </div>
                <div class="flex">
                  <% if(user.display_phone==="yes" ) { %>
                    <input type="checkbox" value="yes" name="display_phone" checked>
                    <label for="display_phone">Display my phone number on profile page</label>
                    <% } else { %>
                      <input type="checkbox" value="yes" name="display_phone">
                      <label for="display_phone">Display my phone number on profile page</label>
                      <% } %>
                </div>
                <div class="user-input">
                  <input type="email" name="email" placeholder="<%= user.email %>" disabled>
                </div>
                <div class="flex">
                  <% if(user.display_email==="yes" ) { %>
                    <input type="checkbox" value="yes" name="display_email" checked>
                    <label for="display_email">Display my email on profile page</label>
                  <% } else { %>
                    <input type="checkbox" value="yes" name="display_email">
                    <label for="display_email">Display my email on profile page</label>
                  <% } %>
                </div>
          
                <div>
                  <button type="submit" id="update-profile-btn">Update</button>
                </div>
          
              </div>
            </div>
          
          </form>


          <!-- SHOWCASE PHOTOS  -->
          <form id="showcaseForm" class="settings-col-2">
            <div class="flex-space-between">
              <h3>Showcase photos</h3>
              <button type="submit" id="update-profile-btn">Upload</button>
            </div>
            <div class="flex-10" style="width: 100%;">
              <div class="showcase-photos flex-2">
                <span class="inner">Drag & drop photos here or <span class="select">Browse</span></span>
                <input name="file" type="file" class="file" multiple="multiple" accept="image/jpeg, image/png, image/jpg" />
              </div>
              <div class="images-container"></div>
            </div>
          </form>

        </div>
       
        
      </div>
    </div>
  </div>


<script src="/js/script.js"></script>

<script>  

  // PROFILE PHOTO ==================================

  const profilePhoto = document.querySelector("#profilePhoto");
  const profilePhotoContainer = document.querySelector(".profile-photo-container")
  const profile = "<%= user.profile_photo %>";
  const uploadCloudPro = document.querySelector("#uploadCloudPro");

  // IF USER HAS A PHOTO IN AWS DO THIS ON PAGE LOAD

  if(profile) {
    uploadCloudPro.style.opacity = "0";
    profilePhoto.style.visibility = "hidden";
    profilePhotoContainer.style.backgroundImage = `url(http://localhost:5000/profile-photo/${profile})`;
  }

  // IF THE USER DELETES THEIR PROFILE PHOTO DO THIS

  document.querySelector("#trashProfilePhoto").addEventListener("click", () => {
    profilePhoto.value = "";
    profilePhoto.style.visibility = "visible";
    profilePhotoContainer.style.backgroundImage = "none";
    uploadCloudPro.style.opacity = "1";
    document.querySelector("#delProPhoto").value = "delete";
  })

  // IF THE USER UPLOADS A NEW PHOTO DO THIS

  profilePhoto.addEventListener('change', function () {
    uploadCloudPro.style.opacity = "0";
    profilePhoto.style.visibility = "hidden";
    const reader = new FileReader();
    reader.addEventListener('load', () => {
      profilePhotoContainer.style.backgroundImage = `url(${reader.result})`;
    });
    reader.readAsDataURL(this.files[0]);
  });

  // COVER PHOTO ==================================

  const coverPhoto = document.querySelector("#coverPhoto");
  const coverPhotoContainer = document.querySelector(".cover-photo-container")
  const cover = "<%= user.cover_photo %>";
  const uploadCloudCov = document.querySelector("#uploadCloudCov");

  // IF USER HAS A PHOTO IN AWS DO THIS ON PAGE LOAD

  if (cover) {
    uploadCloudCov.style.opacity = "0";
    coverPhoto.style.visibility = "hidden";
    coverPhotoContainer.style.backgroundImage = `url(http://localhost:5000/cover-photo/${cover})`;
  }

  // IF THE USER DELETES THEIR COVER PHOTO DO THIS

  document.querySelector("#trashCoverPhoto").addEventListener("click", () => {
    coverPhoto.value = "";
    coverPhoto.style.visibility = "visible";
    coverPhotoContainer.style.backgroundImage = "none";
    uploadCloudCov.style.opacity = "1";
    document.querySelector("#delCovPhoto").value = "delete";
  })

  // IF THE USER UPLOADS A NEW PHOTO DO THIS

  coverPhoto.addEventListener('change', function () {
    uploadCloudCov.style.opacity = "0";
    coverPhoto.style.visibility = "hidden";
    const reader = new FileReader();
    reader.addEventListener('load', () => {
      coverPhotoContainer.style.backgroundImage = `url(${reader.result})`;
    });
    reader.readAsDataURL(this.files[0]);
  });

</script>

<%- include("partials/footer.ejs") %>